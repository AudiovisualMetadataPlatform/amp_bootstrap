# Lifecycle Hook Scripts

To facilitate package-specific functionality in AMP, each package may 
specify a script to be run at different points of the AMP lifecycle.

The available hooks:
* pre - Prior to the package installation
* post - Immediately after the package files have been installed
* config - When AMP is reconfigured
* start - During AMP startup
* stop - During AMP shutdown

The pre/post scripts take a single argument, which is the installation
directory.

All scripts have the AMP_ROOT and AMP_DATA_ROOT environment variables available
and the amp libraries are in the Python path.

## pre
The pre hook allows a package to remove any files that may conflict with an
install or upgrade.  Since the file copy is additive, there may be files left
over from previous installs.

Another use for this hook is to provide the action in a metapackage.  A 
metapackage doesn't have any payload files but will download them at the time
the package is installed.  A good example of this is the tomcat package which
pulls a specific version of tomcat from the apache website.

## post
Post hooks are used to modify the files that have been installed as part of 
the package payload or to test the installation was correct.

The amp-ui package is built as a WAR file in the package but when it is 
installed it needs to be extacted onto the filesystem.  The post script is 
used for this.

## config
The config hook has access to the full AMP configuration and allws the script
to write any package-specific configuration files that are needed for that
package to operate properly.

For example, the amp-rest package config script uses the configuration to 
generate the application.properties file that it needs to start up.  The values
in that file pull not from just the rest section of the configuration but will
also pull the necessary parts from galaxy and the amp install overall.

Additionally, the config hook is a place where persistent configuration can
be generated and stored.   The "secret" values that are used by several 
components are generated by the config hook if they have not already been
set up previously.

## start
The start hook is called when the AMP system is starting up.  Most packages will
not need to hook into this, but freestanding daemons can use this hook to start
up.  Galaxy and Tomcat work in this way.

It also provides a place to hook package initialization functionality, such as
creating the default unit.

## stop
The stop hook is called when AMP is shutting down.


